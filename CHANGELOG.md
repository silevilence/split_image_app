# Changelog

本文档记录 SmartGridSlicer 的所有重要更新。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [1.1.0] - 2025-12-03

### ✨ 新功能

#### 图片后处理流水线 (Image Processing Pipeline)
- **架构设计**: 策略模式 + 责任链，支持动态组合处理步骤
- **参数系统**: 全局参数与单图参数覆盖机制
- **Pipeline 管理器**: 添加/删除/重排序处理步骤
- **步骤重命名**: 支持同类方法自动命名 (如 `Crop-1`, `Crop-2`)
- **HSV 颜色选择器**: 饱和度-亮度 2D 选择区 + 色相滑块 + Alpha 透明度
- **Pipeline 导入/导出**: JSON 格式，支持覆盖/追加模式

#### 内置处理器
- **背景去除 (Background Removal)**: 四角采样 + Flood Fill 泛洪算法
- **边缘裁剪 (Smart Crop)**: 按指定像素值裁剪四边
- **颜色替换 (Color Replace)**: RGB 距离匹配，可调阈值
- **缩放调整 (Resize)**: 双线性插值，支持像素/百分比单位

#### 单图微调 (Per-Image Fine-tuning)
- 大图预览窗右侧可折叠 Pipeline 面板
- Override 复选框启用/禁用单图参数覆盖
- 实时预览处理效果按钮

#### Pipeline 预览与导出集成
- "应用" 按钮触发 Pipeline 预览弹窗
- 显示所有切片处理后的效果
- 显示处理前后尺寸变化
- 导出时自动应用 Pipeline 处理

### 🐛 问题修复

- 修复 Smart Crop 处理器逻辑（改为直接按用户指定像素值裁剪）
- 修复导出时边界检查问题导致的崩溃
- 修复 PreviewModal 测试缺少 PipelineProvider 依赖

### 📦 构建产物

- `SmartGridSlicer-1.1.0-setup.exe` - Windows 安装程序
- `SmartGridSlicer-1.1.0-windows-portable.zip` - 便携版（解压即用）

---

## [1.0.0] - 2025-12-01

### 🎉 首次发布

SmartGridSlicer 的第一个正式版本，提供完整的贴纸图集切割功能。

### ✨ 新增功能

#### 图片导入与显示
- 支持拖拽文件到窗口导入图片
- 支持点击按钮选择图片文件
- 支持 PNG、JPG、WEBP 格式
- 画布支持缩放和平移浏览

#### 网格系统
- 自定义行数和列数设置
- 智能行列适配（根据图片方向自动交换行列）
- 可视化网格线绘制
- 拖拽调整网格线位置
- 键盘方向键微调网格线（1像素精度）
- 右键菜单添加/删除网格线

#### 智能算法
- **均匀分割** - 基础的等分网格算法
- **投影分析法** - 自动检测贴纸缝隙
  - 支持透明/浅色/深色三种背景类型
  - 自动识别边缘并建议边距
- **边缘检测算法** - 基于 Sobel 算子
  - 灰度转换与高斯模糊预处理
  - 边缘密度投影分析
  - 适用于背景不均匀的图片
- 策略模式架构，易于扩展新算法

#### 边距控制
- 四边独立边距设置（上/下/左/右）
- 右键快速设置边距（点击位置直接作为边距值）
- 智能边缘检测按钮
- 可视化边距遮罩显示
- 边距区域排除在切割范围外

#### 编辑功能
- 查看/编辑模式切换
- 完整的撤销/重做系统（最多 50 步历史）
- 网格线选中高亮
- 悬停提示效果

#### 预览系统
- 内存中生成切片缩略图
- 网格布局展示所有切片
- 单个切片勾选导出
- 全选/全不选/反选操作
- 拖拽批量选择切片
- 显示每个切片的尺寸信息

#### 大图预览
- 双击缩略图打开大图预览
- 放大按钮快速预览
- 右键菜单「查看大图」选项
- 左右方向键切换图片
- 空格键切换导出状态
- 自定义文件名后缀编辑
- 高清图片裁剪与缓存

#### 导出功能
- 支持 PNG 和 JPG 格式
- 自定义文件名前缀
- 自定义每个切片的后缀
- Isolate 后台处理，不阻塞 UI
- 实时导出进度显示
- 导出完成后可直接打开文件夹

#### 设置系统
- TOML 格式配置文件
- 默认导出格式设置
- 默认行列数设置
- 默认网格算法选择
- 自定义快捷键绑定
- 快捷键冲突检测
- 自动记忆上次导出目录

#### 界面布局
- Windows 11 风格 UI（fluent_ui）
- 左右分栏布局（编辑器 70% / 控制面板 30%）
- 设置区与预览区可拖拽调整比例
- 面板比例自动记忆
- 各区域独立滚动

#### 快捷键
- `V` - 切换查看/编辑模式
- `Ctrl+Z` - 撤销
- `Ctrl+Y` / `Ctrl+Shift+Z` - 重做
- `方向键` - 微调选中网格线
- `Delete` - 删除选中网格线
- `Esc` - 关闭预览弹窗
- `Space` - 切换当前切片导出状态（预览模式下）

### 🏗️ 技术架构

- **框架**: Flutter 3.x Windows Desktop
- **UI 库**: fluent_ui 4.x
- **状态管理**: Provider 6.x
- **图片处理**: image 包 + Isolate 并行处理
- **配置管理**: toml 包
- **桌面功能**: window_manager, desktop_drop, file_picker

### 📦 构建产物

- `SmartGridSlicer-1.0.0-setup.exe` - Windows 安装程序
- `SmartGridSlicer-1.0.0-windows-portable.zip` - 便携版（解压即用）

---

[1.1.0]: https://github.com/silevilence/split_image_app/releases/tag/v1.1.0
[1.0.0]: https://github.com/silevilence/split_image_app/releases/tag/v1.0.0
